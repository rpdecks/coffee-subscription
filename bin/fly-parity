#!/bin/bash
# Fly.io environment management helpers (inspired by parity gem)
#
# Usage:
#   source bin/fly-parity
#
# Commands:
#   staging console     - Open Rails console on staging
#   production console  - Open Rails console on production
#   staging logs        - Tail staging logs
#   production logs     - Tail production logs
#   staging ssh         - SSH into staging app
#   production ssh      - SSH into production app
#   staging db:migrate  - Run migrations on staging
#   production db:migrate - Run migrations on production

STAGING_APP="coffee-staging"
PRODUCTION_APP="coffee-production"

staging() {
  case "$1" in
    console)
      flyctl ssh console --app $STAGING_APP -C "/rails/bin/rails console"
      ;;
    logs)
      flyctl logs --app $STAGING_APP
      ;;
    ssh)
      flyctl ssh console --app $STAGING_APP
      ;;
    db:migrate)
      flyctl ssh console --app $STAGING_APP -C "./bin/rails db:migrate"
      ;;
    deploy)
      flyctl deploy --config fly.staging.toml
      ;;
    status)
      flyctl status --app $STAGING_APP
      ;;
    *)
      echo "Usage: staging {console|logs|ssh|db:migrate|deploy|status}"
      ;;
  esac
}

production() {
  case "$1" in
    console)
      flyctl ssh console --app $PRODUCTION_APP -C "/rails/bin/rails console"
      ;;
    logs)
      flyctl logs --app $PRODUCTION_APP
      ;;
    ssh)
      flyctl ssh console --app $PRODUCTION_APP
      ;;
    db:migrate)
      flyctl ssh console --app $PRODUCTION_APP -C "./bin/rails db:migrate"
      ;;
    deploy)
      flyctl deploy --config fly.toml
      ;;
    status)
      flyctl status --app $PRODUCTION_APP
      ;;
    *)
      echo "Usage: production {console|logs|ssh|db:migrate|deploy|status}"
      ;;
  esac
}

# Aliases for convenience
alias sc='staging console'
alias pc='production console'
alias sl='staging logs'
alias pl='production logs'
alias sdb='staging db:migrate'
alias pdb='production db:migrate'

echo "Fly.io environment helpers loaded!"
echo "Commands: staging/production {console|logs|ssh|db:migrate|deploy|status}"
echo "Aliases: sc, pc, sl, pl, sdb, pdb"
