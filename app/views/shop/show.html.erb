<% content_for :title, "#{@product.name} - Acer Coffee" %>

<div class="min-h-screen bg-gray-50">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
    <%= link_to "← Back to Shop", shop_path, class: "text-amber-600 hover:text-amber-700 mb-6 inline-block" %>

    <!-- Hero Section with Image and Basic Info -->
    <div class="bg-white rounded-lg shadow-md overflow-hidden mb-12">
      <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
        <!-- Product Image -->
        <div class="bg-gray-100 flex items-center justify-center overflow-hidden relative">
          <% carousel_images = @product.carousel_images %>

          <% if carousel_images.any? %>
            <div
              class="absolute inset-0 group"
              data-controller="product-carousel"
              data-product-carousel-count-value="<%= carousel_images.length %>"
            >
              <div
                class="h-full w-full overflow-hidden"
                data-action="pointerdown->product-carousel#pointerdown pointermove->product-carousel#pointermove pointerup->product-carousel#pointerup pointercancel->product-carousel#pointerup"
                style="touch-action: pan-y;"
              >
                <div class="flex h-full w-full" data-product-carousel-target="track">
                  <% carousel_images.each do |img| %>
                    <div class="h-full w-full flex-none">
                      <%= image_tag img, alt: @product.name, class: "w-full h-full object-cover" %>
                    </div>
                  <% end %>
                </div>
              </div>

              <% if carousel_images.length > 1 %>
                <button
                  type="button"
                  aria-label="Previous image"
                  class="absolute left-6 top-1/2 -translate-y-1/2 bg-white/90 backdrop-blur h-10 w-10 rounded-full shadow-sm ring-1 ring-black/10 flex items-center justify-center text-gray-700 opacity-0 group-hover:opacity-100 hover:bg-white focus:opacity-100 focus:outline-none focus-visible:ring-2 focus-visible:ring-amber-300 transition"
                  data-action="product-carousel#prev"
                >
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
                  </svg>
                </button>
                <button
                  type="button"
                  aria-label="Next image"
                  class="absolute right-6 top-1/2 -translate-y-1/2 bg-white/90 backdrop-blur h-10 w-10 rounded-full shadow-sm ring-1 ring-black/10 flex items-center justify-center text-gray-700 opacity-0 group-hover:opacity-100 hover:bg-white focus:opacity-100 focus:outline-none focus-visible:ring-2 focus-visible:ring-amber-300 transition"
                  data-action="product-carousel#next"
                >
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                  </svg>
                </button>
              <% end %>
            </div>
          <% else %>
            <div class="h-96 md:h-full bg-gradient-to-br from-amber-100 to-amber-200 flex items-center justify-center w-full">
              <svg class="w-48 h-48 text-amber-400" fill="currentColor" viewBox="0 0 20 20">
                <path d="M10 2a6 6 0 00-6 6v3.586l-.707.707A1 1 0 004 14h12a1 1 0 00.707-1.707L16 11.586V8a6 6 0 00-6-6zM10 18a3 3 0 01-3-3h6a3 3 0 01-3 3z"/>
              </svg>
            </div>
          <% end %>
        </div>

        <!-- Product Details -->
        <div class="p-8">
          <h1 class="text-4xl font-bold text-gray-900 mb-4"><%= @product.name %></h1>

          <div class="text-3xl font-bold text-amber-600 mb-6">
            $<%= '%.2f' % @product.price %>
          </div>

          <% if @product.description.present? %>
            <div class="mb-8">
              <p class="text-gray-700 leading-relaxed"><%= @product.description %></p>
            </div>
          <% end %>

          <div class="border-t border-b py-6 mb-8">
            <dl class="space-y-3">
              <div class="flex justify-between">
                <dt class="text-gray-600">Type</dt>
                <dd class="font-medium text-gray-900"><%= @product.product_type.titleize %></dd>
              </div>
              <% if @product.roast_type %>
                <div class="flex justify-between">
                  <dt class="text-gray-600">Roast</dt>
                  <dd class="font-medium text-gray-900"><%= @product.roast_type.titleize %></dd>
                </div>
              <% end %>
              <% if @product.inventory_count %>
                <div class="flex justify-between">
                  <dt class="text-gray-600">Availability</dt>
                  <dd class="font-medium text-gray-900">
                    <%= @product.inventory_count %> in stock
                  </dd>
                </div>
              <% end %>
            </dl>
          </div>

          <%= form_with url: shop_add_to_cart_path, method: :post, local: true do |f| %>
            <%= f.hidden_field :product_id, value: @product.id %>

            <div class="mb-6">
              <label class="block text-sm font-medium text-gray-700 mb-2">Quantity</label>
              <%= f.number_field :quantity, value: 1, min: 1, max: 10,
                  class: "w-32 border border-gray-300 rounded-lg px-4 py-3 text-lg" %>
            </div>

            <%= f.submit "Add to Cart",
                class: "w-full bg-amber-600 text-white py-4 rounded-lg hover:bg-amber-700 transition font-bold text-lg" %>
          <% end %>

          <div class="mt-6 text-center">
            <p class="text-sm text-gray-500">
              Free shipping on orders over $50
            </p>
          </div>
        </div>
      </div>
    </div>

    <!-- Full Cupping Notes Section (for Deshojo and Palmatum) -->
    <% if @product.name.downcase.include?("deshojo") || @product.name.downcase.include?("palmatum") %>
      <div class="mt-12 bg-white rounded-lg shadow-md overflow-hidden p-8">
        <h2 class="text-3xl font-bold text-gray-900 mb-6">Full Cupping Notes</h2>

        <% if @product.name.downcase.include?("deshojo") %>
          <div class="prose prose-lg max-w-none mb-8">
            <p class="text-gray-700 leading-relaxed">
              The Deshojo Blend celebrates the vibrant crimson energy of spring transformation in the Japanese maple tradition. This coffee mirrors the leaf's bold character—deep-hued, complex, and full of life. Crafted from carefully selected Central American and East African origins, this medium-dark roast delivers notes of dark cherry, cocoa nib, and a subtle cedar undertone. The cup presents a smooth, velvety body with balanced sweetness and a bright, lingering finish that echoes the bold colors of the Deshojo leaf through the seasons.
            </p>
          </div>

          <h3 class="text-xl font-bold text-gray-900 mb-4">Specs</h3>
          <div class="overflow-x-auto">
            <table class="w-full text-sm">
              <tbody class="divide-y divide-gray-200">
                <tr class="hover:bg-gray-50">
                  <td class="px-4 py-3 font-medium text-gray-700">Region</td>
                  <td class="px-4 py-3 text-gray-600">Central America, East Africa</td>
                </tr>
                <tr class="hover:bg-gray-50">
                  <td class="px-4 py-3 font-medium text-gray-700">Processing</td>
                  <td class="px-4 py-3 text-gray-600">Washed, Natural</td>
                </tr>
                <tr class="hover:bg-gray-50">
                  <td class="px-4 py-3 font-medium text-gray-700">Roast Level</td>
                  <td class="px-4 py-3 text-gray-600">Medium-Dark</td>
                </tr>
                <tr class="hover:bg-gray-50">
                  <td class="px-4 py-3 font-medium text-gray-700">Tasting Notes</td>
                  <td class="px-4 py-3 text-gray-600">Dark Cherry, Cocoa, Cedar</td>
                </tr>
                <tr class="hover:bg-gray-50">
                  <td class="px-4 py-3 font-medium text-gray-700">Best For</td>
                  <td class="px-4 py-3 text-gray-600">Espresso, Milk Drinks, Pour Over</td>
                </tr>
                <tr class="hover:bg-gray-50">
                  <td class="px-4 py-3 font-medium text-gray-700">Body</td>
                  <td class="px-4 py-3 text-gray-600">Velvety, Full</td>
                </tr>
              </tbody>
            </table>
          </div>
        <% elsif @product.name.downcase.include?("palmatum") %>
          <div class="prose prose-lg max-w-none mb-8">
            <p class="text-gray-700 leading-relaxed">
              The Palmatum Blend draws its name from Acer palmatum, the elegant Japanese maple that forms the foundation of the maple world. This origin species—the base from which countless cultivars have been developed—is mirrored in this coffee's versatility and elegance. A signature offering from Acer Coffee, this blend is syrupy and bittersweet with espresso-forward character. Crafted from an all Central American selection, it showcases notes of high cacao dark chocolate, truffles, molasses, and toasted almond with a subtle lemon peel tang. The cup offers complex, creamy mouthfeel and lingering finish. Expect a full-bodied experience with balanced sweetness and moderate acidity—perfect as a straight espresso or in milk drinks.
            </p>
          </div>

          <h3 class="text-xl font-bold text-gray-900 mb-4">Specs</h3>
          <div class="overflow-x-auto">
            <table class="w-full text-sm">
              <tbody class="divide-y divide-gray-200">
                <tr class="hover:bg-gray-50">
                  <td class="px-4 py-3 font-medium text-gray-700">Region</td>
                  <td class="px-4 py-3 text-gray-600">Central America</td>
                </tr>
                <tr class="hover:bg-gray-50">
                  <td class="px-4 py-3 font-medium text-gray-700">Processing</td>
                  <td class="px-4 py-3 text-gray-600">Washed</td>
                </tr>
                <tr class="hover:bg-gray-50">
                  <td class="px-4 py-3 font-medium text-gray-700">Roast Level</td>
                  <td class="px-4 py-3 text-gray-600">Signature (Medium-Dark)</td>
                </tr>
                <tr class="hover:bg-gray-50">
                  <td class="px-4 py-3 font-medium text-gray-700">Tasting Notes</td>
                  <td class="px-4 py-3 text-gray-600">Dark Chocolate, Truffles, Molasses, Almond, Lemon Peel</td>
                </tr>
                <tr class="hover:bg-gray-50">
                  <td class="px-4 py-3 font-medium text-gray-700">Best For</td>
                  <td class="px-4 py-3 text-gray-600">Espresso, Milk Drinks</td>
                </tr>
                <tr class="hover:bg-gray-50">
                  <td class="px-4 py-3 font-medium text-gray-700">Body</td>
                  <td class="px-4 py-3 text-gray-600">Full, Syrupy</td>
                </tr>
              </tbody>
            </table>
          </div>
        <% end %>
      </div>
    <% end %>
  </div>
</div>
