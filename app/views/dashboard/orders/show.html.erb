<div class="container mx-auto px-4 py-12">
  <div class="max-w-4xl mx-auto">
    <!-- Header -->
    <div class="mb-8">
      <div class="flex items-center gap-3 mb-2">
        <%= link_to dashboard_orders_path, class: "text-brown hover:text-brown/80" do %>
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
          </svg>
        <% end %>
        <h1 class="text-3xl font-bold text-gray-900">Order <%= @order.order_number %></h1>
      </div>
      <div class="flex items-center gap-3">
        <% status_colors = {
          'pending' => 'bg-gray-100 text-gray-800',
          'processing' => 'bg-blue-100 text-blue-800',
          'roasting' => 'bg-orange-100 text-orange-800',
          'shipped' => 'bg-purple-100 text-purple-800',
          'delivered' => 'bg-green-100 text-green-800',
          'cancelled' => 'bg-red-100 text-red-800'
        } %>
        <span class="px-3 py-1 text-sm font-medium rounded-full <%= status_colors[@order.status] || 'bg-gray-100 text-gray-800' %>">
          <%= @order.status.titleize %>
        </span>
        <span class="text-sm text-gray-500">Placed <%= @order.created_at.strftime("%B %d, %Y") %></span>
      </div>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
      <!-- Main Content -->
      <div class="lg:col-span-2 space-y-6">
        <!-- Order Items -->
        <div class="bg-white rounded-lg border border-gray-200 p-6">
          <h2 class="text-xl font-semibold text-gray-900 mb-4">Order Items</h2>
          <div class="space-y-4">
            <% @order.order_items.each do |item| %>
              <div class="flex gap-4 py-4 border-b border-gray-100 last:border-0">
                <div class="flex-1">
                  <h3 class="font-semibold text-gray-900"><%= item.product.name %></h3>
                  <div class="mt-1 space-y-1">
                    <p class="text-sm text-gray-600">
                      <span class="font-medium">Grind:</span> <%= item.grind_type.titleize %>
                    </p>
                    <p class="text-sm text-gray-600">
                      <span class="font-medium">Quantity:</span> <%= item.quantity %>
                    </p>
                  </div>
                </div>
                <div class="text-right">
                  <p class="font-semibold text-gray-900">$<%= sprintf("%.2f", item.price_cents / 100.0) %></p>
                  <p class="text-sm text-gray-500">$<%= sprintf("%.2f", item.price_cents / 100.0) %> each</p>
                </div>
              </div>
            <% end %>
          </div>
        </div>

        <!-- Shipping Information -->
        <% if @order.shipping_address %>
          <div class="bg-white rounded-lg border border-gray-200 p-6">
            <h2 class="text-xl font-semibold text-gray-900 mb-4">Shipping Address</h2>
            <div class="text-gray-700">
              <p class="font-medium"><%= current_user.full_name %></p>
              <p><%= @order.shipping_address.street_address %></p>
              <% if @order.shipping_address.street_address_2.present? %>
                <p><%= @order.shipping_address.street_address_2 %></p>
              <% end %>
              <p><%= @order.shipping_address.city %>, <%= @order.shipping_address.state %> <%= @order.shipping_address.zip_code %></p>
            </div>
            
            <% if @order.tracking_number.present? %>
              <div class="mt-6 pt-6 border-t border-gray-200">
                <h3 class="text-sm font-semibold text-gray-900 mb-2">Tracking Information</h3>
                <div class="flex items-center gap-2">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path d="M9 17a2 2 0 11-4 0 2 2 0 014 0zM19 17a2 2 0 11-4 0 2 2 0 014 0z" />
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16V6a1 1 0 00-1-1H4a1 1 0 00-1 1v10a1 1 0 001 1h1m8-1a1 1 0 01-1 1H9m4-1V8a1 1 0 011-1h2.586a1 1 0 01.707.293l3.414 3.414a1 1 0 01.293.707V16a1 1 0 01-1 1h-1m-6-1a1 1 0 001 1h1M5 17a2 2 0 104 0m-4 0a2 2 0 114 0m6 0a2 2 0 104 0m-4 0a2 2 0 114 0" />
                  </svg>
                  <%= link_to "https://tools.usps.com/go/TrackConfirmAction?tLabels=#{@order.tracking_number}", target: "_blank", rel: "noopener noreferrer", class: "font-mono text-sm text-brown hover:text-brown/80 hover:underline" do %>
                    <%= @order.tracking_number %>
                  <% end %>
                </div>
              </div>
            <% end %>
          </div>
        <% end %>
      </div>

      <!-- Sidebar -->
      <div class="space-y-6">
        <!-- Order Summary -->
        <div class="bg-white rounded-lg border border-gray-200 p-6">
          <h2 class="text-xl font-semibold text-gray-900 mb-4">Order Summary</h2>
          <div class="space-y-3">
            <div class="flex justify-between text-gray-700">
              <span>Subtotal</span>
              <span>$<%= sprintf("%.2f", @order.subtotal) %></span>
            </div>
            <div class="flex justify-between text-gray-700">
              <span>Shipping</span>
              <span>$<%= sprintf("%.2f", @order.shipping) %></span>
            </div>
            <div class="flex justify-between text-gray-700">
              <span>Tax</span>
              <span>$<%= sprintf("%.2f", @order.tax) %></span>
            </div>
            <div class="pt-3 border-t border-gray-200">
              <div class="flex justify-between text-lg font-semibold text-gray-900">
                <span>Total</span>
                <span>$<%= sprintf("%.2f", @order.total) %></span>
              </div>
            </div>
          </div>
        </div>

        <!-- Payment Method -->
        <% if @order.payment_method %>
          <div class="bg-white rounded-lg border border-gray-200 p-6">
            <h2 class="text-xl font-semibold text-gray-900 mb-4">Payment Method</h2>
            <div class="flex items-center gap-3">
              <% if @order.payment_method.card_brand == 'visa' %>
                <svg class="h-8 w-12" viewBox="0 0 48 32" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <rect width="48" height="32" rx="4" fill="#1434CB"/>
                  <path d="M21.3 20.4L23.1 11.6H25.5L23.7 20.4H21.3ZM32.7 11.8C32.2 11.6 31.4 11.4 30.4 11.4C28 11.4 26.3 12.6 26.3 14.3C26.3 15.6 27.5 16.3 28.4 16.7C29.3 17.1 29.6 17.4 29.6 17.8C29.6 18.4 28.9 18.7 28.2 18.7C27.2 18.7 26.7 18.6 25.9 18.2L25.6 18.1L25.3 19.9C25.9 20.2 26.9 20.5 28 20.5C30.5 20.5 32.2 19.3 32.2 17.5C32.2 16.5 31.5 15.7 30.1 15.1C29.3 14.7 28.8 14.4 28.8 14C28.8 13.6 29.2 13.2 30.1 13.2C30.9 13.2 31.5 13.3 32 13.6L32.3 13.7L32.7 11.8ZM36.8 11.6H34.9C34.3 11.6 33.8 11.8 33.6 12.4L29.9 20.4H32.4L32.9 19H35.9L36.2 20.4H38.4L36.8 11.6ZM33.5 17.2L34.7 14L35.3 17.2H33.5ZM19.8 11.6L17.5 18.1L17.2 16.7L16.4 12.7C16.3 12.2 15.9 11.6 15.3 11.6H11.1L11 11.9C11.8 12.1 12.7 12.4 13.4 12.8L15.5 20.4H18L22.3 11.6H19.8Z" fill="white"/>
                </svg>
              <% elsif @order.payment_method.card_brand == 'mastercard' %>
                <svg class="h-8 w-12" viewBox="0 0 48 32" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <rect width="48" height="32" rx="4" fill="#EB001B"/>
                  <circle cx="19" cy="16" r="10" fill="#FF5F00"/>
                  <circle cx="29" cy="16" r="10" fill="#F79E1B"/>
                </svg>
              <% end %>
              <div>
                <p class="font-medium text-gray-900"><%= @order.payment_method.card_brand.titleize %></p>
                <p class="text-sm text-gray-600">•••• <%= @order.payment_method.last_four %></p>
              </div>
            </div>
          </div>
        <% end %>

        <!-- Order Timeline -->
        <div class="bg-white rounded-lg border border-gray-200 p-6">
          <h2 class="text-xl font-semibold text-gray-900 mb-4">Order Timeline</h2>
          <div class="space-y-4">
            <div class="flex gap-3">
              <div class="flex-shrink-0 w-2 h-2 mt-2 rounded-full bg-green-500"></div>
              <div>
                <p class="font-medium text-gray-900">Order Placed</p>
                <p class="text-sm text-gray-600"><%= @order.created_at.strftime("%b %d, %Y at %l:%M %p") %></p>
              </div>
            </div>
            <% if @order.shipped_at %>
              <div class="flex gap-3">
                <div class="flex-shrink-0 w-2 h-2 mt-2 rounded-full bg-green-500"></div>
                <div>
                  <p class="font-medium text-gray-900">Shipped</p>
                  <p class="text-sm text-gray-600"><%= @order.shipped_at.strftime("%b %d, %Y at %l:%M %p") %></p>
                </div>
              </div>
            <% end %>
            <% if @order.delivered_at %>
              <div class="flex gap-3">
                <div class="flex-shrink-0 w-2 h-2 mt-2 rounded-full bg-green-500"></div>
                <div>
                  <p class="font-medium text-gray-900">Delivered</p>
                  <p class="text-sm text-gray-600"><%= @order.delivered_at.strftime("%b %d, %Y at %l:%M %p") %></p>
                </div>
              </div>
            <% end %>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
